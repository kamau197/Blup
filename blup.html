<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>

<style>
    :root {
        --pink:#FFC1CC;
        --lav:#E6E6FA;
        --mint:#B5F5D1;
        --sky:#C3E7FF;
    }

    body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, var(--pink), var(--lav), var(--sky));
    }

    .card {
        background: white;
        padding: 40px;
        width: 350px;
        border-radius: 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        text-align: center;
    }

    h2 {
        margin-bottom: 20px;
        color: #444;
        font-size: 26px;
        letter-spacing: 1px;
    }

    .btn {
        width: 100%;
        padding: 14px;
        border-radius: 12px;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 10px 0;
        font-size: 16px;
        cursor: pointer;
        transition: .2s;
        font-weight: 500;
        gap: 10px;
    }

    .btn img {
        width: 22px;
        height: 22px;
    }

    .google {
        background: var(--mint);
    }

    .google:hover {
        background: #a6ecc7;
    }

    .github {
        background: var(--sky);
    }

    .github:hover {
        background: #b3dcf8;
    }
</style>

</head>
<body>

<div class="card">
    <h2>Welcome Back</h2>

    <!-- GOOGLE BUTTON -->
    <a href="/auth/google">
        <button class="btn google">
            <img src="https://www.svgrepo.com/show/475656/google-color.svg">
            Continue with Google
        </button>
    </a>

    <!-- GITHUB BUTTON -->
    <a href="/auth/github">
        <button class="btn github">
            <img src="https://www.svgrepo.com/show/512317/github-142.svg">
            Continue with GitHub
        </button>
    </a>
</div>
<script>
const express = require("express");
const session = require("express-session");
const passport = require("passport");
const GoogleStrategy = require("passport-google-oauth20").Strategy;
const GitHubStrategy = require("passport-github2").Strategy;

const app = express();

// SESSION
app.use(
  session({
    secret: "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",
    resave: false,
    saveUninitialized: false
  })
);

app.use(passport.initialize());
app.use(passport.session());

// SERIALIZE USER
passport.serializeUser((user, done) => {
  done(null, user);
});

passport.deserializeUser((user, done) => {
  done(null, user);
});

/

/* ----------------------------
    GITHUB STRATEGY
----------------------------- */
passport.use(
  new GitHubStrategy(
    {
      clientID: "Ov23libiqO78Sw3KZpAb",
      clientSecret: "10709aef68d378b729c56bdda995d84d60be7a0d",
      callbackURL: "http://localhost:3000/auth/github/callback"
    },
    (accessToken, refreshToken, profile, done) => {
      return done(null, profile);
    }
  )
);

/* ----------------------------
    ROUTES
----------------------------- */

// LOGIN BUTTON ROUTES
app.get("/auth/google", passport.authenticate("google", { scope: ["profile", "email"] }));
app.get("/auth/github", passport.authenticate("github", { scope: ["user:email"] }));

// CALLBACK ROUTES
app.get(
  "/auth/google/callback",
  passport.authenticate("google", { failureRedirect: "/login" }),
  (req, res) => {
    res.redirect("/dashboard");
  }
);

app.get(
  "/auth/github/callback",
  passport.authenticate("github", { failureRedirect: "/login" }),
  (req, res) => {
    res.redirect("/dashboard");
  }
);

// PROTECTED PAGE
app.get("/dashboard", (req, res) => {
  if (!req.user) return res.redirect("/login");
  res.send(`<h1>Welcome ${req.user.displayName}</h1>`);
});

// LOGIN PAGE
app.get("/login", (req, res) => {
  res.send(`
    <h1>Login</h1>
    <a href="/auth/google">Login with Google</a><br>
    <a href="/auth/github">Login with GitHub</a>
  `);
});

// LOGOUT
app.get("/logout", (req, res) => {
  req.logout(() => {
    res.redirect("/login");
  });
});

app.listen(3000, () => console.log("Server running on http://localhost:3000")); 
</script>
</body>
</html>